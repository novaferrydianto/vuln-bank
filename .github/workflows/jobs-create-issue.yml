name: Reusable - Create Security Issue

on:
  workflow_call:
    inputs:
      app_name:
        type: string
        required: true
      sca_high:
        type: string
        required: true
      sca_critical:
        type: string
        required: true
      dast_alerts:
        type: string
        required: true

jobs:
  create_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create GitHub Issue
        uses: actions/github-script@v7
        with:
          script: |
            const app = core.getInput('app_name');

            const scaHigh = core.getInput('sca_high');
            const scaCritical = core.getInput('sca_critical');
            const dastAlerts = core.getInput('dast_alerts');

            const title = `⚠️ Security findings for ${app}`;

            const body = [
              `### Security Summary`,
              ``,
              `- SCA HIGH: ${scaHigh}`,
              `- SCA CRITICAL: ${scaCritical}`,
              `- DAST Alerts: ${dastAlerts}`,
              ``,
              `Check artifacts in the latest workflow run for full details.`,
            ].join("\n");

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title,
              body,
              labels: ["security", "auto-created"]
            });

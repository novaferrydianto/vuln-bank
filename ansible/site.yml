---
# ==========================================================
# Bastion Node (Local)
# ==========================================================
- name: Bastion Hardening + Runner Setup
  hosts: bastion
  become: true

  roles:
    - base_common
    - cis_hardening
    - bastion_runner

# ==========================================================
# Hosting / App Node
# ==========================================================
- name: Hosting VM — Docker + App + Security Agents
  hosts: hosting
  become: true

  roles:
    - base_common
    - cis_hardening
    - docker_engine
    - app_hosting
    - openscap_scan
    - falco_install

# ==========================================================
# Database Node
# ==========================================================
- name: Database VM — Secure PostgreSQL + Security Agents
  hosts: db
  become: true

  roles:
    - base_common
    - cis_hardening
    - docker_engine
    - postgres_host
    - openscap_scan
    - falco_install

# ==========================================================
# Compliance Report Export (Run from Bastion)
# ==========================================================
- name: Collect Compliance Reports to Bastion
  hosts: hosting,db
  gather_facts: false
  become: true

  roles:
    - compliance_export

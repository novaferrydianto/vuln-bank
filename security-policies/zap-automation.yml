env:
  contexts:
    - name: vuln-bank
      urls:
        - ${target_url}
      includePaths:
        - ${target_url}.*
      authentication:
        method: none

  parameters:
    failOnError: false
    failOnWarning: false
    progressToStdout: true

jobs:
  # --------------------------------------------------
  # Passive Scan Configuration
  # --------------------------------------------------
  - type: passiveScan-config
    parameters:
      maxAlertsPerRule: 1000
      scanOnlyInScope: true

  # --------------------------------------------------
  # Spider
  # --------------------------------------------------
  - type: spider
    parameters:
      context: vuln-bank
      url: ${target_url}
      maxDepth: 5
      maxDuration: 3

  # --------------------------------------------------
  # Wait for Passive Scan
  # --------------------------------------------------
  - type: passiveScan-wait
    parameters:
      timeout: 60

  # --------------------------------------------------
  # Active Scan (controlled + safe)
  # --------------------------------------------------
  - type: activeScan
    parameters:
      context: vuln-bank
      scanOnlyInScope: true
      policy: Default Policy
      maxRuleDurationInMins: 2
      maxScanDurationInMins: 5
      threadPerHost: 2

  # --------------------------------------------------
  # Reports
  # --------------------------------------------------
  - type: report
    parameters:
      template: traditional-json
      reportDir: /zap/wrk
      reportFile: zap_alerts.json

  - type: report
    parameters:
      template: sarif-json
      reportDir: /zap/wrk
      reportFile: zap.sarif

  # --------------------------------------------------
  # Summary (for gating & metrics)
  # --------------------------------------------------
  - type: outputSummary
    parameters:
      outputFile: /zap/wrk/zap_out.json
